<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dockerfile_opam (dockerfile-opam.Dockerfile_opam)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.4"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">dockerfile-opam</a> &#x00BB; Dockerfile_opam</nav><header class="odoc-preamble"><h1>Module <code><span>Dockerfile_opam</span></code></h1><p>Rules for generating Dockerfiles involving OPAM.</p><p>These are deployed at <a href="https://hub.docker.com/r/ocaml/opam">ocaml/opam</a> on the Docker Hub. The interfaces here may change as the production deployments there change, so please contact <code>anil@recoil.org</code> if you depend on these functions for your own infrastructure.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Distro"><a href="#module-Distro" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Distro/index.html">Distro</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Run Opam commands across a matrix of Docker containers. Each of these containers represents a different version of OCaml, Opam and an OS distribution (such as Debian or Alpine).</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Linux"><a href="#module-Linux" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Linux/index.html">Linux</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Linux distribution-specific Dockerfile utility functions</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Windows"><a href="#module-Windows" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Windows/index.html">Windows</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Windows specific Dockerfile utility functions.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_as_opam"><a href="#val-run_as_opam" class="anchor"></a><code><span><span class="keyword">val</span> run_as_opam : <span><span><span>(<span class="type-var">'a</span>, unit, string, <a href="../../dockerfile/Dockerfile/index.html#type-t">Dockerfile.t</a>)</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>run_as_opam fmt</code> runs the command specified by the <code>fmt</code> format string as the <code>opam</code> user.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-install_opam_from_source"><a href="#val-install_opam_from_source" class="anchor"></a><code><span><span class="keyword">val</span> install_opam_from_source : 
  <span><span class="optlabel">?add_default_link</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?prefix</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?enable_0install_solver</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?with_vendored_deps</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">branch</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">hash</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="../../dockerfile/Dockerfile/index.html#type-t">Dockerfile.t</a></span></code></div><div class="spec-doc"><p>Commands to install OPAM via a source code checkout from GitHub. The <code>branch</code> can be a git tag or branch (e.g. <code>2.0</code> for opam 2.0.x or <code>2.1</code> for the opam 2.1.x). The binaries are installed under <code>&lt;prefix&gt;/bin/opam-&lt;branch&gt;</code>, defaulting to <code>/usr/local/bin</code>. If <code>add_default_link</code> is true (the default), then the <code>opam-&lt;branch&gt;</code> binary is hardlinked to <code>opam</code>. Set it to false if you want to install multiple opam binaries from different branches in the same container. If <code>enable_0install_solver</code> is true (false by default), then the <code>builtin-0install</code> solver should be accessible in the resulting opam binary. Configure opam build <code>with_vendored_deps</code>. Required for opam 2.2.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-opam_hashes"><a href="#type-opam_hashes" class="anchor"></a><code><span><span class="keyword">type</span> opam_hashes</span><span> = </span><span>{</span></code><ol><li id="type-opam_hashes.opam_2_0_hash" class="def record field anchored"><a href="#type-opam_hashes.opam_2_0_hash" class="anchor"></a><code><span>opam_2_0_hash : string;</span></code></li><li id="type-opam_hashes.opam_2_1_hash" class="def record field anchored"><a href="#type-opam_hashes.opam_2_1_hash" class="anchor"></a><code><span>opam_2_1_hash : string;</span></code></li><li id="type-opam_hashes.opam_2_2_hash" class="def record field anchored"><a href="#type-opam_hashes.opam_2_2_hash" class="anchor"></a><code><span>opam_2_2_hash : string;</span></code></li><li id="type-opam_hashes.opam_2_3_hash" class="def record field anchored"><a href="#type-opam_hashes.opam_2_3_hash" class="anchor"></a><code><span>opam_2_3_hash : string;</span></code></li><li id="type-opam_hashes.opam_master_hash" class="def record field anchored"><a href="#type-opam_hashes.opam_master_hash" class="anchor"></a><code><span>opam_master_hash : string;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gen_opam2_distro"><a href="#val-gen_opam2_distro" class="anchor"></a><code><span><span class="keyword">val</span> gen_opam2_distro : 
  <span><span class="optlabel">?override_tag</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?clone_opam_repo</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?arch</span>:<span class="xref-unresolved">Ocaml_version</span>.arch <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?labels</span>:<span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">opam_hashes</span>:<a href="#type-opam_hashes">opam_hashes</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Distro/index.html#type-t">Distro.t</a> <span class="arrow">&#45;&gt;</span></span>
  string * <a href="../../dockerfile/Dockerfile/index.html#type-t">Dockerfile.t</a></span></code></div><div class="spec-doc"><p><code>gen_opam2_distro ~opam_hashes d</code> will generate a Dockerfile for Linux distribution <code>d</code> with opam 2.0, opam 2.1, opam 2.2 and opam master, per hash given in parameter.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>a tuple of the Docker tag and the Dockerfile. If <code>clone_opam_repo</code> is true (the default) then the Dockerfile will also git clone the official opam-repository into <code>/home/opam/opam-repository</code>. If <code>arch</code> is not specified, it defaults to the base image that is assumed to be multiarch (the main exception to this is i386, which requires different base images from amd64). For native Windows distributions, if <code>winget</code> is omitted, then winget will be build in an prepended build stage. If specified, then winget will be pulled from the <code>winget</code> external image.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ocaml_depexts"><a href="#val-ocaml_depexts" class="anchor"></a><code><span><span class="keyword">val</span> ocaml_depexts : <span><a href="Distro/index.html#type-t">Distro.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Ocaml_version</span>.t <span class="arrow">&#45;&gt;</span></span> <a href="../../dockerfile/Dockerfile/index.html#type-t">Dockerfile.t</a></span></code></div><div class="spec-doc"><p><code>ocaml_depexts distro version</code> returns packages that are required under <code>distro</code> by the OCaml distribution at version <code>version</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-all_ocaml_compilers"><a href="#val-all_ocaml_compilers" class="anchor"></a><code><span><span class="keyword">val</span> all_ocaml_compilers : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ocaml_version</span>.arch <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Distro/index.html#type-t">Distro.t</a> <span class="arrow">&#45;&gt;</span></span>
  string * <a href="../../dockerfile/Dockerfile/index.html#type-t">Dockerfile.t</a></span></code></div><div class="spec-doc"><p><code>all_ocaml_compilers hub_id arch distro</code> will generate an opam2 container that has all the recent OCaml compilers installed into a distribution <code>distro</code> on architecture <code>arch</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-separate_ocaml_compilers"><a href="#val-separate_ocaml_compilers" class="anchor"></a><code><span><span class="keyword">val</span> separate_ocaml_compilers : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ocaml_version</span>.arch <span class="arrow">&#45;&gt;</span></span>
  <span><a href="Distro/index.html#type-t">Distro.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string * <a href="../../dockerfile/Dockerfile/index.html#type-t">Dockerfile.t</a>)</span> list</span></span></code></div><div class="spec-doc"><p><code>separate_ocaml_compilers hub_id arch distro</code> will install a list of Dockerfiles that build individual OCaml compiler versions and their variants (e.g. flambda) in separate containers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-deprecated"><a href="#val-deprecated" class="anchor"></a><code><span><span class="keyword">val</span> deprecated : <a href="../../dockerfile/Dockerfile/index.html#type-t">Dockerfile.t</a></span></code></div><div class="spec-doc"><p><code>deprecated</code> is a minimal container that outputs a deprecation error. This is used to replace unsupported containers on the Hub rather than leaving an unmaintained distribution lying around with possible security holes.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-multiarch_manifest"><a href="#val-multiarch_manifest" class="anchor"></a><code><span><span class="keyword">val</span> multiarch_manifest : 
  <span><span class="label">target</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">platforms</span>:<span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  string</span></code></div><div class="spec-doc"><p><code>multiarch_manifest ~target ~platforms</code> will generate a manifest-tool compliant yaml file to build a <code>target</code> on the given multiarch <code>platforms</code>.</p></div></div></div></body></html>
